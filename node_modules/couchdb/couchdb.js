var cradle = require('cradle'),
    _      = require('underscore');

var connection = new(cradle.Connection)('http://192.168.3.110', 5984, {
    auth: {
        username: 'web',
        password: 'web'
    }
});

var db = connection.database('jobdata');

exports.suggest = function(suggest,cb) {
	//var suggestData = {}; 
	console.time("jobdata");
	db.view('Jobdata/by_suggest', {
	    startkey: suggest,
	    endkey: suggest+"ZZZZ",
	    group: true,
		
	}, function(err, res) {
	    if (err) throw err.error
			// console.dir(res);
			//suggestData = res;
			//console.dir(suggestData);
			if (_.isEmpty(res)) return cb({noData:true});
			var dataRes = {};
			//console.dir(res);
			for (i in res) {
				dataRes[res[i].key]=_.flatten(res[i].value);
		  }
			//console.dir(dataRes);
			// res = {
			// 	
			// 	key: res[0].key,
			// 	value:data
			// };
			//console.dir(res);
			console.timeEnd("jobdata");
			return cb(dataRes);
			});
			

};